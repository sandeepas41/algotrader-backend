# Application
spring.application.name=algotrader
spring.profiles.active=dev

# Import holiday calendar config
spring.config.import=classpath:holidays.yml

# Jackson
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.default-property-inclusion=non_null

# JPA
spring.jpa.open-in-view=false
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.format_sql=true

# Flyway
spring.flyway.enabled=false
spring.flyway.locations=classpath:db/migration

# Redis
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=500ms

# Cache
spring.cache.type=caffeine

# Server
server.port=40002
server.servlet.context-path=/

# Actuator
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized

# Kite Connect
kite.api-key=${KITE_API_KEY:}
kite.api-secret=${KITE_API_SECRET:}
kite.auto-login.enabled=true
kite.auto-login.user-id=${KITE_USERID:}
kite.auto-login.password=${KITE_PASSWORD:}
kite.auto-login.otp-secret=${KITE_OTP_SECRET_KEY:}
kite.auto-login.headless=false

# AlgoTrader
algotrader.trading-mode=PAPER
algotrader.auth.jwt-secret=a3f8c2e91b6d4a7f0e5c8b1d3a9f6e2c7b4d0a8e5f1c3b9d6a2e8f4c0b7d3a1
algotrader.async.core-pool-size=4
algotrader.async.max-pool-size=8
algotrader.async.queue-capacity=500
algotrader.cors.allowed-origin=http://localhost:40000

# Risk Limits (null = check disabled)
# algotrader.risk.max-loss-per-position=50000
# algotrader.risk.max-profit-per-position=100000
# algotrader.risk.max-lots-per-position=10
# algotrader.risk.max-position-value=5000000
# algotrader.risk.daily-loss-limit=100000
# algotrader.risk.daily-loss-warning-threshold=0.8
# algotrader.risk.max-margin-utilization=0.7
# algotrader.risk.max-open-positions=20
# algotrader.risk.max-open-orders=50
# algotrader.risk.max-active-strategies=10
# algotrader.risk.max-loss-per-strategy=25000
# algotrader.risk.max-legs-per-strategy=4

# Notifications
notifications.telegram.enabled=false
notifications.telegram.bot-token=${TELEGRAM_BOT_TOKEN:}
notifications.telegram.chat-id=${TELEGRAM_CHAT_ID:}
notifications.telegram.max-messages-per-minute=60

# Resilience4j Rate Limiter
# kiteOrders: 8 req/sec (conservative vs Kite's 10/sec limit, leaves headroom for kill switch)
resilience4j.ratelimiter.instances.kiteOrders.limitForPeriod=8
resilience4j.ratelimiter.instances.kiteOrders.limitRefreshPeriod=1s
resilience4j.ratelimiter.instances.kiteOrders.timeoutDuration=500ms
# kiteQuotes: 10 req/sec for quote/position/margin API calls
resilience4j.ratelimiter.instances.kiteQuotes.limitForPeriod=10
resilience4j.ratelimiter.instances.kiteQuotes.limitRefreshPeriod=1s
resilience4j.ratelimiter.instances.kiteQuotes.timeoutDuration=500ms

# Resilience4j Circuit Breaker
resilience4j.circuitbreaker.instances.kiteApi.failureRateThreshold=50
resilience4j.circuitbreaker.instances.kiteApi.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.kiteApi.slidingWindowSize=10
resilience4j.circuitbreaker.instances.kiteApi.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.kiteApi.permittedNumberOfCallsInHalfOpenState=3

# Resilience4j Retry
resilience4j.retry.instances.kiteApi.maxAttempts=3
resilience4j.retry.instances.kiteApi.waitDuration=1s
resilience4j.retry.instances.kiteApi.enableExponentialBackoff=true
resilience4j.retry.instances.kiteApi.exponentialBackoffMultiplier=2
resilience4j.retry.instances.kiteApi.retryExceptions=java.io.IOException,java.net.SocketTimeoutException
resilience4j.retry.instances.kiteApi.ignoreExceptions=com.zerodhatech.kiteconnect.kitehttp.exceptions.TokenException,com.zerodhatech.kiteconnect.kitehttp.exceptions.InputException
